<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<title>Royal muthu</title>

<style>
html, body {
    margin:0;
    padding:0;
    overflow:hidden;
    background: linear-gradient(#87CEEB, #cdefff);
    touch-action: manipulation;
}

canvas {
    display:block;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<audio id="bgm" loop>
    <source src="bgm.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let bgm = document.getElementById("bgm");

let gameStarted = false;
let gameOver = false;

let isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);

let gravity = isMobile ? 0.22 : 0.25;
let velocity = 0;

let score = 0;

let friend = new Image();
friend.src = "friend.png";

// ---------- BIRD ----------
let bird = {
    x: 80,
    y: 200,
    width: 70,
    height: 70
};

// ---------- CLOUDS ----------
let clouds = [];
for(let i=0;i<5;i++){
    clouds.push({
        x: Math.random()*canvas.width,
        y: Math.random()*250,
        size: 120 + Math.random()*80
    });
}

// ---------- PIPES ----------
let pipes = [];
let pipeWidth = 90;
let pipeGap = 240;

function createPipe(){
    let topHeight = Math.random()*(canvas.height - pipeGap - 200) + 50;

    pipes.push({
        x: canvas.width,
        top: topHeight,
        bottom: topHeight + pipeGap,
        passed:false
    });
}

// ---------- FLAP ----------
function flap(isMobileInput=false){

    if(!gameStarted){
        gameStarted = true;
        bgm.play().catch(()=>{});
    }

    if(!gameOver){

        if(isMobileInput){
            velocity = -7; // weaker jump on phone
        } else {
            velocity = -9; // stronger jump on desktop
        }

    } else {
        location.reload();
    }
}

// keyboard
document.addEventListener("keydown", e=>{
    if(e.code === "Space") flap(false);
});

// touch
canvas.addEventListener("touchstart", e=>{
    e.preventDefault();
    flap(true);
});

// ---------- CLOUD DRAW ----------
function drawClouds(){

    ctx.fillStyle="white";

    clouds.forEach(cloud=>{

        ctx.beginPath();
        ctx.arc(cloud.x, cloud.y, cloud.size/2, 0, Math.PI*2);
        ctx.arc(cloud.x + cloud.size/2, cloud.y + 10, cloud.size/2.5, 0, Math.PI*2);
        ctx.arc(cloud.x - cloud.size/2, cloud.y + 10, cloud.size/2.5, 0, Math.PI*2);
        ctx.arc(cloud.x, cloud.y + 20, cloud.size/2.2, 0, Math.PI*2);
        ctx.fill();

        cloud.x -= 0.5;

        if(cloud.x + cloud.size < 0){
            cloud.x = canvas.width + 100;
            cloud.y = Math.random()*250;
        }
    });
}

// ---------- PIPE DRAW ----------
function drawPipes(){

    ctx.fillStyle="#2ecc71";
    ctx.strokeStyle="#27ae60";
    ctx.lineWidth=6;

    pipes.forEach(pipe=>{

        // top
        ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
        ctx.strokeRect(pipe.x, 0, pipeWidth, pipe.top);

        // bottom
        ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);
        ctx.strokeRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);

        pipe.x -= 2;

        // scoring
        if(!pipe.passed && pipe.x + pipeWidth < bird.x){
            score++;
            pipe.passed = true;
        }

        // collision
        if(
            bird.x + bird.width > pipe.x &&
            bird.x < pipe.x + pipeWidth &&
            (bird.y < pipe.top || bird.y + bird.height > pipe.bottom)
        ){
            gameOver = true;
            bgm.pause();
        }
    });

    pipes = pipes.filter(p => p.x + pipeWidth > 0);
}

// ---------- GAME LOOP ----------
let frame = 0;

function gameLoop(){

    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawClouds();

    if(gameStarted && !gameOver){

        velocity += gravity;
        bird.y += velocity;

        frame++;
        if(frame % 140 === 0){
            createPipe();
        }
    }

    drawPipes();

    ctx.drawImage(friend, bird.x, bird.y, bird.width, bird.height);

    // ground collision
    if(bird.y + bird.height > canvas.height){
        gameOver = true;
    }

    // score
    ctx.fillStyle="black";
    ctx.font="40px Arial";
    ctx.fillText(score, canvas.width/2, 70);

    // start text
    if(!gameStarted){
        ctx.font="30px Arial";
        ctx.fillText("Tap or Press Space", canvas.width/2 - 150, canvas.height/2);
    }

    // game over
    if(gameOver){
        ctx.font="30px Arial";
        ctx.fillText("Game Over - Tap to Restart", canvas.width/2 - 180, canvas.height/2);
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();

</script>
</body>
</html>
