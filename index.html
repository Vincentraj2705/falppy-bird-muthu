<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<title>Flappy Friend</title>

<style>
body{
margin:0;
overflow:hidden;
touch-action:none;
background:skyblue;
font-family:Arial;
}

canvas{
position:fixed;
top:0;
left:0;
}

#start,#over{
position:fixed;
width:100%;
height:100%;
display:flex;
justify-content:center;
align-items:center;
flex-direction:column;
color:white;
background:rgba(0,0,0,0.3);
font-size:28px;
z-index:10;
}

button{
padding:12px 25px;
font-size:18px;
border:none;
border-radius:8px;
cursor:pointer;
}
</style>
</head>

<body>

<div id="start">Tap / Press SPACE to Start</div>

<div id="over" style="display:none">
Game Over
<div id="scoreText"></div>
<button onclick="restart()">Restart</button>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

// ===== IMAGES =====
let face = new Image();
face.src = "friend.png";

// ===== AUDIO =====
let bgm = new Audio("bgm.mp3");
bgm.loop = true;

// ===== GAME VARIABLES =====
let started=false;
let gravity=0.45;
let velocity=0;
let score=0;
let speed=2.5;

// ===== BIRD =====
let bird={
x:canvas.width*0.2,
y:canvas.height*0.4,
size:canvas.width*0.16,
};

// ===== CLOUDS =====
let clouds=[];
for(let i=0;i<5;i++){
clouds.push({
x:Math.random()*canvas.width,
y:Math.random()*canvas.height*0.5,
size:80+Math.random()*60,
speed:0.3+Math.random()*0.3
});
}

// ===== PIPES =====
let pipes=[];
let gap = canvas.height*0.30;
let pipeWidth = canvas.width*0.12;

// spawn using distance control (NO OVERLAP)
let pipeDistance = canvas.width*0.6;

function spawnPipe(){
let lastPipe = pipes[pipes.length-1];

if(!lastPipe || lastPipe.x < canvas.width - pipeDistance){

let top = Math.random()*(canvas.height*0.45)+60;

pipes.push({
x:canvas.width,
top:top,
bottom:top+gap,
passed:false
});
}
}

// ===== DRAW CLOUDS =====
function drawClouds(){
ctx.fillStyle="white";

clouds.forEach(c=>{
ctx.beginPath();
ctx.arc(c.x,c.y,c.size*0.5,0,Math.PI*2);
ctx.arc(c.x+40,c.y+10,c.size*0.4,0,Math.PI*2);
ctx.arc(c.x-40,c.y+10,c.size*0.4,0,Math.PI*2);
ctx.fill();

c.x -= c.speed;
if(c.x<-100) c.x = canvas.width+100;
});
}

// ===== DRAW BIRD =====
function drawBird(){
ctx.drawImage(face,
bird.x-bird.size/2,
bird.y-bird.size/2,
bird.size,
bird.size);
}

// ===== DRAW PIPES =====
function drawPipes(){

pipes.forEach(p=>{

let grad = ctx.createLinearGradient(p.x,0,p.x+pipeWidth,0);
grad.addColorStop(0,"#2ecc71");
grad.addColorStop(1,"#27ae60");

ctx.fillStyle=grad;

// Top
ctx.fillRect(p.x,0,pipeWidth,p.top);
ctx.fillRect(p.x-5,p.top-25,pipeWidth+10,25);

// Bottom
ctx.fillRect(p.x,p.bottom,pipeWidth,canvas.height);
ctx.fillRect(p.x-5,p.bottom,pipeWidth+10,25);

});
}

// ===== COLLISION =====
function hit(pipe){

let r = bird.size*0.35;

if(
bird.x+r > pipe.x &&
bird.x-r < pipe.x+pipeWidth &&
(bird.y-r < pipe.top || bird.y+r > pipe.bottom)
){
return true;
}
return false;
}

// ===== UPDATE =====
function update(){

if(!started) return;

velocity += gravity;
bird.y += velocity;

spawnPipe();

pipes.forEach(p=>{
p.x -= speed;

if(!p.passed && p.x+pipeWidth < bird.x){
score++;
p.passed=true;
speed += 0.05; // gradual difficulty
}

if(hit(p)) gameOver();
});

pipes = pipes.filter(p=>p.x+pipeWidth>0);

if(bird.y > canvas.height || bird.y < 0) gameOver();
}

// ===== GAME OVER =====
function gameOver(){
started=false;
bgm.pause();
document.getElementById("over").style.display="flex";
document.getElementById("scoreText").innerText="Score : "+score;
}

// ===== DRAW SCORE =====
function drawScore(){
ctx.fillStyle="black";
ctx.font="bold 30px Arial";
ctx.fillText(score,20,50);
}

// ===== LOOP =====
function loop(){
ctx.clearRect(0,0,canvas.width,canvas.height);

drawClouds();
drawPipes();
drawBird();
drawScore();
update();

requestAnimationFrame(loop);
}
loop();

// ===== START =====
function startGame(){
if(!started){
started=true;
velocity=-8;
bgm.play().catch(()=>{});
document.getElementById("start").style.display="none";
}
}

// ===== RESTART =====
function restart(){
pipes=[];
score=0;
speed=2.5;
bird.y=canvas.height*0.4;
velocity=0;

document.getElementById("over").style.display="none";
document.getElementById("start").style.display="flex";
}

// ===== CONTROLS =====
document.addEventListener("keydown",e=>{
if(e.code==="Space"){
startGame();
velocity=-8;
}
});

// FIXED MOBILE TOUCH
canvas.addEventListener("touchstart",function(e){
e.preventDefault();
startGame();
velocity=-8;
},{passive:false});
</script>

</body>
</html>
