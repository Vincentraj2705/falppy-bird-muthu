<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<title>Royal Muthu</title>

<style>
html, body {
    margin:0;
    padding:0;
    overflow:hidden;
    background: skyblue;
    touch-action: manipulation;
}

canvas {
    display:block;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<audio id="bgm" loop>
    <source src="bgm.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let bgm = document.getElementById("bgm");

let gameStarted = false;
let gameOver = false;

let gravity = 0.5;
let velocity = 0;

let score = 0;

let friend = new Image();
friend.src = "friend.png";   // your friend's photo

// ---------- BIRD ----------
let bird = {
    x: 80,
    y: 200,
    width: 60,
    height: 60
};

// ---------- CLOUDS ----------
let clouds = [];
for(let i=0;i<5;i++){
    clouds.push({
        x: Math.random()*canvas.width,
        y: Math.random()*250,
        size: 120 + Math.random()*80
        });
}

// ---------- PIPES ----------
let pipes = [];
let pipeWidth = 90;
let pipeGap = 220; // BIGGER GAP

function createPipe(){
    let topHeight = Math.random()*(canvas.height - pipeGap - 200) + 50;

    pipes.push({
        x: canvas.width,
        top: topHeight,
        bottom: topHeight + pipeGap,
        passed:false
    });
}

// ---------- INPUT ----------
function flap(){
    if(!gameStarted){
        gameStarted = true;
        bgm.play().catch(()=>{});
    }

    if(!gameOver){
        velocity = -9;
    } else {
        location.reload();
    }
}

document.addEventListener("keydown", e=>{
    if(e.code === "Space") flap();
});

canvas.addEventListener("touchstart", e=>{
    e.preventDefault();
    flap();
});

// ---------- DRAW CLOUDS ----------
function drawClouds(){

    ctx.fillStyle="white";

    clouds.forEach(cloud=>{

        // main cloud body
        ctx.beginPath();
        ctx.arc(cloud.x, cloud.y, cloud.size/2, 0, Math.PI*2);
        ctx.arc(cloud.x + cloud.size/2, cloud.y + 10, cloud.size/2.5, 0, Math.PI*2);
        ctx.arc(cloud.x - cloud.size/2, cloud.y + 10, cloud.size/2.5, 0, Math.PI*2);
        ctx.arc(cloud.x, cloud.y + 20, cloud.size/2.2, 0, Math.PI*2);
        ctx.fill();

        // movement
        cloud.x -= 0.6;

        if(cloud.x + cloud.size < 0){
            cloud.x = canvas.width + 100;
            cloud.y = Math.random() * 200;
        }

    });
}


// ---------- DRAW PIPES ----------
function drawPipes(){

    ctx.fillStyle = "#2ecc71";
    ctx.strokeStyle = "#27ae60";
    ctx.lineWidth = 6;

    pipes.forEach(pipe=>{

        // top pipe
        ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
        ctx.strokeRect(pipe.x, 0, pipeWidth, pipe.top);

        // bottom pipe
        ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);
        ctx.strokeRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);

        pipe.x -= 2;

        // scoring
        if(!pipe.passed && pipe.x + pipeWidth < bird.x){
            score++;
            pipe.passed = true;
        }

        // collision
        if(
            bird.x + bird.width > pipe.x &&
            bird.x < pipe.x + pipeWidth &&
            (bird.y < pipe.top || bird.y + bird.height > pipe.bottom)
        ){
            gameOver = true;
            bgm.pause();
        }
    });

    // remove old pipes
    pipes = pipes.filter(p=>p.x + pipeWidth > 0);
}

// ---------- GAME LOOP ----------
let frame = 0;

function gameLoop(){

    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawClouds();

    if(gameStarted && !gameOver){

        velocity += gravity;
        bird.y += velocity;

        frame++;
        if(frame % 140 === 0){
            createPipe();
        }
    }

    drawPipes();

    // draw bird
    ctx.drawImage(friend, bird.x, bird.y, bird.width, bird.height);

    // ground collision
    if(bird.y + bird.height > canvas.height){
        gameOver = true;
    }

    // score
    ctx.fillStyle="black";
    ctx.font="40px Arial";
    ctx.fillText(score, canvas.width/2, 70);

    if(!gameStarted){
        ctx.fillText("Tap or Press Space", canvas.width/2 - 150, canvas.height/2);
    }

    if(gameOver){
        ctx.fillText("Game Over - Tap to Restart", canvas.width/2 - 220, canvas.height/2);
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();

</script>
</body>
</html>

